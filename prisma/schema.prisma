generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                  Int       @id @default(autoincrement())
  email               String    @unique
  password            String
  fullName            String
  profileImage        String?
  tempPassword        String?
  emailVerified       Boolean   @default(false)
  verificationToken   String?
  verificationExpires DateTime?
  createdAt           DateTime  @default(now())
  lastLogin           DateTime?

  clinics            ClinicUser[]
  invitesCreated     Invite[]          @relation("InviteCreator")
  doctorProfile      DoctorProfile?
  receptionistProfile ReceptionistProfile?
}

model DoctorProfile {
  id               Int      @id @default(autoincrement())
  userId           Int      @unique
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  specialization   String?
  subspecialty      String?
  licenseNumber    String?
  prcId            String?
  bio              String?
  consultationFee  Float?
  clinicHours      String?
  digitalSignature String?
  ptrTaxId         String?
  ePrescriptionId  String?
  education        String?
  experience       Int?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model ReceptionistProfile {
  id                    Int      @id @default(autoincrement())
  userId                Int      @unique
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  dateOfBirth           String?
  address               String?
  phone                 String?
  emergencyContactName  String?
  emergencyContactPhone String?
  position              String?
  yearsOfExperience     Int?
  skills                String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model Appointment {
  id              Int       @id @default(autoincrement())
  patientName     String
  patientPhone    String?
  patientEmail    String?
  patientAge      String?
  patientGender   String?
  doctorName      String
  appointmentDate String
  appointmentTime String?
  appointmentType String?
  status          String    @default("scheduled")
  tokenNumber     String?
  notes           String?
  symptoms        String?
  medicalHistory  String?
  medications     String?
  vitalSigns      String?   // JSON string
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @default(now()) @updatedAt
}

model Prescription {
  id               Int      @id @default(autoincrement())
  patientName      String
  patientAge       String?
  patientGender    String?
  patientPhone     String?
  patientEmail     String?
  prescriptionDate String?
  diagnosis        String?
  symptoms         String?
  doctorId         Int?
  doctorName       String
  medicines        String?  // JSON string
  instructions     String?
  followUpDate     String?
  status           String?
  notes            String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @updatedAt
}

model Medicine {
  id                  Int      @id @default(autoincrement())
  name                String
  category            String?
  strength            String?
  form                String?
  manufacturer        String?
  description         String?
  sideEffects         String?
  contraindications   String?
  dosageInstructions  String?
  storageInstructions String?
  price               Float?
  stockQuantity       Int?
  reorderLevel        Int?
  isActive            Boolean  @default(true)
  createdBy           String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @default(now()) @updatedAt
}

model Invoice {
  id               Int      @id @default(autoincrement())
  invoiceNumber    String?
  patientName      String
  patientPhone     String?
  patientEmail     String?
  items            String?  // JSON string
  totalAmount      Float
  status           String   @default("pending")
  paymentMethod    String?
  paymentDate      String?
  paymentReference String?
  paymentNotes     String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @updatedAt
}

model Payment {
  id            Int      @id @default(autoincrement())
  invoiceId     Int?
  invoiceNumber String?
  patientName   String?
  patientPhone  String?
  amount        Float?
  method        String?
  reference     String?
  notes         String?
  processedBy   String?
  processedAt   DateTime @default(now())
}

model Clinic {
  id        Int      @id @default(autoincrement())
  name      String
  address   String?
  phone     String?
  email     String?
  createdAt DateTime @default(now())

  users        ClinicUser[]
  invites      Invite[]
  patients     Patient[]
  subscription Subscription?
}

model Role {
  id   Int    @id @default(autoincrement())
  name String @unique

  clinicUsers ClinicUser[]
  invites     Invite[]
}

model ClinicUser {
  id        Int      @id @default(autoincrement())
  userId    Int
  clinicId  Int
  roleId    Int
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  clinic Clinic @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, clinicId, roleId])
  @@index([userId])
  @@index([clinicId])
}

model Invite {
  id         Int       @id @default(autoincrement())
  email      String
  clinicId   Int
  roleId     Int
  token      String    @unique
  expiresAt  DateTime
  createdBy  Int
  createdAt  DateTime  @default(now())
  acceptedAt DateTime?

  clinic  Clinic @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  role    Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  creator User   @relation("InviteCreator", fields: [createdBy], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([email])
}

model Patient {
  id                           Int      @id @default(autoincrement())
  fullName                     String
  dateOfBirth                  String?
  gender                       String?
  civilStatus                  String?
  nationalId                   String?
  phone                        String?
  email                        String?
  address                      String?
  emergencyContactName         String?
  emergencyContactPhone        String?
  emergencyContactRelationship String?
  insuranceProvider            String?
  insurancePolicyNumber        String?
  hmoAccount                   String?
  referredBy                   String?
  firstVisitDate               String?
  preferredCommunication       String?
  bloodType                    String?
  allergies                    String?
  currentMedications           String?
  medicalHistory               String?
  surgicalHistory              String?
  familyHistory                String?
  smokingAlcoholUse            String?
  height                       Float?
  weight                       Float?
  vaccinationStatus            String?
  profileImage                 String?
  attachments                  String?  // JSON
  specialtyData                String?  // JSON
  clinicId                     Int
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime @updatedAt

  clinic Clinic @relation(fields: [clinicId], references: [id], onDelete: Cascade)

  @@index([clinicId])
  @@index([phone])
  @@index([fullName])
}

model Plan {
  id           Int      @id @default(autoincrement())
  name         String   @unique
  priceMonthly Int
  priceYearly  Int
  maxDoctors   Int?
  maxStaff     Int?
  multiClinic  Boolean  @default(false)
  features     String?
  createdAt    DateTime @default(now())

  subscriptions Subscription[]
}

model Subscription {
  id          Int       @id @default(autoincrement())
  clinicId    Int       @unique
  planId      Int
  status      String
  trialEndsAt DateTime?
  startsAt    DateTime  @default(now())
  endsAt      DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  clinic Clinic @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  plan   Plan   @relation(fields: [planId], references: [id])

  @@index([clinicId])
  @@index([status])
}
